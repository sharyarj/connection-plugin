{"version":3,"file":"connection-plugin.esm.js","sources":["../src/utils.ts","../src/picker/view.ts","../src/picker/index.ts","../src/flow.ts","../src/index.ts"],"sourcesContent":["import { Emitter, Connection } from 'rete';\nimport { EventsTypes } from 'rete/types/events';\n\nfunction toTrainCase(str: string) {\n    return str.toLowerCase().replace(/ /g, '-');\n}\n\nexport function getMapItemRecursively<T extends any>(map: WeakMap<Element, T>, el: Element): T | null {\n    return map.get(el) || (el.parentElement ? getMapItemRecursively(map, el.parentElement) : null);\n}\n\nexport function defaultPath(points: number[], curvature: number) {\n    const [x1, y1, x2, y2] = points;\n    const hx1 = x1 + Math.abs(x2 - x1) * curvature;\n    const hx2 = x2 - Math.abs(x2 - x1) * curvature;\n\n    return `M ${x1} ${y1} C ${hx1} ${y1} ${hx2} ${y2} ${x2} ${y2}`;\n}\n\nexport function renderPathData(emitter: Emitter<EventsTypes>, points: number[], connection?: Connection) {\n    const data = { points, connection, d: '' };\n    \n    emitter.trigger('connectionpath', data);\n    \n    return data.d || defaultPath(points, 0.4);\n}\n\nexport function updateConnection({ el, d } : { el: HTMLElement, d: string }) {\n    const path = el.querySelector('.connection path');\n\n    if (!path) throw new Error('Path of connection was broken');\n\n    path.setAttribute('d', d);\n}\n\nexport function renderConnection({ el, d, connection } : { el: HTMLElement, d: string, connection?: Connection }) {\n    const classed = !connection?[]:[\n        'input-' + toTrainCase(connection.input.name),\n        'output-' + toTrainCase(connection.output.name),\n        'socket-input-' + toTrainCase(connection.input.socket.name),\n        'socket-output-' + toTrainCase(connection.output.socket.name)\n    ];\n\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')\n\n\n    console.log(connection!.output);\n\n    svg.classList.add('connection', ...classed);\n    path.classList.add('main-path');\n    path.setAttribute('d', d);\n\n    svg.appendChild(path);\n    el.appendChild(svg);\n\n    updateConnection({ el, d });\n}","import { Output, Input, Emitter } from 'rete';\nimport { EditorView } from 'rete/types/view/index';\nimport { EventsTypes } from 'rete/types/events';\nimport { renderConnection, renderPathData, updateConnection } from '../utils';\n\nexport class PickerView {\n\n    private el: HTMLElement;\n\n    constructor(\n        private emitter: Emitter<EventsTypes>,\n        private editorView: EditorView\n    ) {\n        this.el = document.createElement('div');\n        this.el.style.position = 'absolute';\n        this.editorView.area.appendChild(this.el);\n    }\n\n    updatePseudoConnection(io: Output | Input | null) {\n        if (io !== null) {\n            this.renderConnection(io);\n        } else if (this.el.parentElement) {\n            this.el.innerHTML = '';\n        }\n    }\n\n    private getPoints(io: Output | Input): number[] {\n        const mouse = this.editorView.area.mouse;\n\n        if(!io.node) throw new Error('Node in output/input not found')\n    \n        const node = this.editorView.nodes.get(io.node);\n\n        if(!node) throw new Error('Node view not found')\n    \n        const [x1, y1] = node.getSocketPosition(io);\n\n        return io instanceof Output\n            ? [x1, y1, mouse.x, mouse.y]\n            : [mouse.x, mouse.y, x1, y1];\n    }\n\n    updateConnection(io: Output | Input) {\n        const d = renderPathData(this.emitter, this.getPoints(io));\n\n        updateConnection({ el: this.el, d });\n    }\n\n    renderConnection(io: Output | Input) {\n        const d = renderPathData(this.emitter, this.getPoints(io));\n\n        renderConnection({ el: this.el, d });\n    }\n}","import { NodeEditor, Input, Output, Connection } from 'rete';\nimport { PickerView } from './view';\n\nexport class Picker {\n\n    private editor: NodeEditor;\n    private _io: Output | Input | null = null;\n    public view: PickerView;\n\n    constructor(editor: NodeEditor) {\n        this.editor = editor;\n        this.view = new PickerView(editor, editor.view);\n\n        editor.on('mousemove', () => this.io && this.view.updateConnection(this.io));\n    }\n\n    get io() : Output | Input | null {\n        return this._io;\n    }\n\n    set io(io: Output | Input | null) {\n        this._io = io;\n        this.view.updatePseudoConnection(io);\n    }\n\n    reset() {\n        this.io = null;\n    }\n\n    pickOutput(output: Output) {\n        if (!this.editor.trigger('connectionpick', output)) return;\n        \n        if (this.io instanceof Input) {\n            if(!output.multipleConnections && output.hasConnection())\n                this.editor.removeConnection(output.connections[0])\n    \n            this.editor.connect(output, this.io);\n            this.reset();\n            return;\n        }\n\n        if (this.io) this.reset();\n        this.io = output;\n    }\n\n    pickInput(input: Input) {\n        if (!this.editor.trigger('connectionpick', input)) return;\n\n        if (this.io === null) {\n            if (input.hasConnection()) {\n                this.io = input.connections[0].output;\n                this.editor.removeConnection(input.connections[0]);\n            } else {\n                this.io = input;\n            }\n            return true;\n        }\n\n        if (!input.multipleConnections && input.hasConnection())\n            this.editor.removeConnection(input.connections[0]);\n        \n        if (!this.io.multipleConnections && this.io.hasConnection())\n            this.editor.removeConnection(this.io.connections[0]);\n        \n        if (this.io instanceof Output && this.io.connectedTo(input)) {\n            let connection = input.connections.find(c => c.output === this.io);\n\n            if(connection) {\n                this.editor.removeConnection(connection);\n            }\n        }\n\n        if(this.io instanceof Output) {\n            this.editor.connect(this.io, input);\n            this.reset();\n        }\n    }\n\n    pickConnection(connection: Connection) {\n        const { output } = connection;\n\n        this.editor.removeConnection(connection);\n        this.io = output;\n    }\n}","import { IO, Input, Output } from 'rete';\nimport { Picker } from './picker';\n\nexport type FlowParams = { input?: Input, output?: Output };\n\nexport class Flow {\n\n    private picker: Picker;\n    private target?: IO | null;\n\n    constructor(picker: Picker) {\n        this.picker = picker;\n        this.target = null;\n    }\n\n    private act({ input, output }: FlowParams) {\n        if (this.unlock(input || output)) return\n\n        if (input)\n            this.picker.pickInput(input)\n        else if (output)\n            this.picker.pickOutput(output)\n        else\n            this.picker.reset();\n    }\n\n    public start(params: FlowParams, io?: IO) {\n        this.act(params);\n        this.target = io;\n    }\n\n    public complete(params: FlowParams = {}) {\n        this.act(params);\n    }\n\n    public hasTarget() {\n        return Boolean(this.target);\n    }\n\n    private unlock(io?: IO) {\n        const target = this.target;\n\n        this.target = null;\n\n        return target && target === io;\n    }\n}","import { NodeEditor } from 'rete';\nimport { renderConnection, renderPathData, updateConnection, getMapItemRecursively } from './utils';\nimport { Picker } from './picker';\nimport { Flow, FlowParams } from './flow';\nimport './events';\nimport './index.sass';\n\nfunction install(editor: NodeEditor) {\n    editor.bind('connectionpath');\n    editor.bind('connectiondrop');\n    editor.bind('connectionpick');\n    editor.bind('resetconnection');\n    \n    const picker = new Picker(editor);\n    const flow = new Flow(picker);\n    const socketsParams = new WeakMap<Element, FlowParams>();\n    \n    function pointerDown(this: HTMLElement, e: PointerEvent) {\n        const flowParams = socketsParams.get(this);\n\n        if(flowParams) {\n            const { input, output } = flowParams;\n            \n            editor.view.container.dispatchEvent(new PointerEvent('pointermove', e));\n            e.preventDefault();\n            e.stopPropagation();\n            flow.start({ input, output }, input || output);\n        }\n    }\n\n    function pointerUp(this: Window, e: PointerEvent) {\n        const flowEl = document.elementFromPoint(e.clientX, e.clientY);\n\n        if(picker.io) {\n            editor.trigger('connectiondrop', picker.io)\n        }\n        if(flowEl) {\n            flow.complete(getMapItemRecursively(socketsParams, flowEl) || {})\n        }\n    }\n\n    editor.on('resetconnection', () => flow.complete());\n\n    editor.on('rendersocket', ({ el, input, output }) => {\n        socketsParams.set(el, { input, output });\n\n        el.removeEventListener('pointerdown', pointerDown);\n        el.addEventListener('pointerdown', pointerDown);\n    });\n\n    window.addEventListener('pointerup', pointerUp);\n\n    editor.on('renderconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        renderConnection({ el, d, connection })\n    });\n\n    editor.on('updateconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        updateConnection({ el, d });\n    });\n\n    editor.on('destroy', () => {\n        window.removeEventListener('pointerup', pointerUp);\n    });\n}\n\nexport default {\n    name: 'connection',\n    install\n}\nexport { defaultPath } from './utils';"],"names":["toTrainCase","str","toLowerCase","replace","getMapItemRecursively","map","el","get","parentElement","defaultPath","points","curvature","x1","y1","x2","y2","hx1","Math","abs","hx2","renderPathData","emitter","connection","data","d","trigger","updateConnection","path","querySelector","Error","setAttribute","renderConnection","classed","input","name","output","socket","svg","document","createElementNS","console","log","classList","add","appendChild","PickerView","editorView","createElement","style","position","area","io","innerHTML","mouse","node","nodes","getSocketPosition","Output","x","y","getPoints","Picker","editor","view","on","Input","multipleConnections","hasConnection","removeConnection","connections","connect","reset","connectedTo","find","c","_io","updatePseudoConnection","Flow","picker","target","unlock","pickInput","pickOutput","params","act","Boolean","install","bind","flow","socketsParams","WeakMap","pointerDown","e","flowParams","container","dispatchEvent","PointerEvent","preventDefault","stopPropagation","start","pointerUp","flowEl","elementFromPoint","clientX","clientY","complete","set","removeEventListener","addEventListener","window"],"mappings":"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"}